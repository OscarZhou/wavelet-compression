//A very simple cosine transform for blocks of images
//This code is O(N^2), there are more efficient ways to compute DCTs
//OpenCV has faster DCT transform implementations
#include "stdio.h"
#include "math.h"
#define PI 3.14159265358979323846264338327950288419716939937510582097494459230
#define N 16  



void DWT(float* data, int size)
{
	float* temp = new float[size];

    int h = size >> 1;
    for (int i = 0; i < h; i++)
    {
        int k = (i << 1);
        temp[i] = (data[k] + data[k + 1]) / 2;
        temp[i + h] = data[k] - temp[i];
    }

    for (int i = 0; i < size; i++)
        data[i] = temp[i];
}


void IDWT(float* data, int size)
{
	float* temp = new float[size];

    int h = size >> 1;
    for (int i = 0; i < h; i++)
    {
        int k = (i << 1);
        temp[k] = data[i] + data[i + h];
        temp[k + 1] = 2 * data[i] - temp[k];
    }

    for (int i = 0; i < size; i++)
        data[i] = temp[i];
}

main(){

	//IMAGE: uncomment and comment the appropriate lines to change the original values
	//image, repeated values are represented by fewer coefficients
	#if (N==16)

	//coefficients
	float C[N][N]= {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};

	//image recovery
	float I[N][N]= {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};

	int IMAGE[N][N]=
	{1,127,127,120,120,123,124,23,1,127,127,120,120,123,124,23,
	1,127,127,120,120,123,124,23,1,127,127,120,120,123,124,23,
	1,127,127,120,120,123,124,23,1,127,127,120,120,123,124,23,
	1,127,127,120,120,123,124,23,1,127,127,120,120,123,124,23,
	1,127,127,120,120,123,124,23,1,127,127,120,120,123,124,23,
	1,127,127,120,120,123,124,23,1,127,127,120,120,123,124,23,
	1,127,127,120,120,123,124,23,1,127,127,120,120,123,124,23,
	1,127,127,120,120,123,124,23,1,127,127,120,120,123,124,23,
	1,127,127,120,120,123,124,23,1,127,127,120,120,123,124,23,
	1,127,127,120,120,123,124,23,1,127,127,120,120,123,124,23,
	1,127,127,120,120,123,124,23,1,127,127,120,120,123,124,23,
	1,127,127,120,120,123,124,23,1,127,127,120,120,123,124,23,
	1,127,127,120,120,123,124,23,1,127,127,120,120,123,124,23,
	1,127,127,120,120,123,124,23,1,127,127,120,120,123,124,23,
	1,127,127,120,120,123,124,23,1,127,127,120,120,123,124,23,
	1,127,127,120,120,123,124,23,1,127,127,120,120,123,124,23};


	//quantized coefficients
	int R[N][N]= {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
	//decompressed image
	int DECOMPIMAGE[N][N]=
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};


	//alternative image, note that all coefficients are different than zero
	#elif (N==8)

	//coefficients
	float C[N][N]= 
	{0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0};

	int IMAGE[N][N]=
	{1,2,67,12,127,200,24,123,
	32,27,1,12,10,123,14,223,
	45,17,7,10,14,123,24,23,
	57,17,2,2,15,123,1,43,
	78,17,1,1,180,123,2,26,
	78,27,2,0,190,123,4,63,
	98,127,7,0,110,123,24,83,
	100,127,17,0,11,123,4,28};



	//quantized coefficients
	int R[N][N]= {
	0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0};
	#endif


	for (int a=0;a<N;a++)
	{

		for (int b=0;b<N;b++)
		{
			printf("%d  ",IMAGE[a][b]);
			if (((b+1)%N)==0) printf("\n");
		} 
	
	}

	#if 1
	int times = 1;  //transform times

	for(int i =0; i<times;i++)
	{
		int n = N >> i;


		float* row = new float[n];

		for (int a=0;a<N;a++)
		{

			for (int b=0;b<n;b++)
			{	
				row[b] = IMAGE[a][b];
			}
			DWT(row, n);
			for (int b=0;b<n;b++)
			{
				C[b][a]=row[b];
			} 
	
		}

		for (int a=0;a<N;a++)
		{

			for (int b=0;b<n;b++)
			{
				row[b] = C[a][b];

			}
			DWT(row, n);
			for (int b=0;b<n;b++)
			{
				R[a][b]=(int)round(row[b]);
			} 
	
		}
		printf("\n");

		for (int a=0;a<N;a++)
		{

			for (int b=0;b<N;b++)
			{
				IMAGE[a][b] = R[b][a];
			} 
	
		}


		for (int a=0;a<N;a++)
		{

			for (int b=0;b<N;b++)
			{
				printf("%d  ",IMAGE[a][b]);
				if (((b+1)%N)==0) printf("\n");
			} 
	
		}
		////////////////////////////////////


		for (int a=0;a<N;a++)
		{

			for (int b=0;b<n;b++)
			{
				row[b] = IMAGE[b][a];
		
			}
			IDWT(row, n);
			for (int b=0;b<n;b++)
			{
				C[b][a]=row[b];
			} 
	
		}

		printf("print C::::\n\n\n");

		for (int a=0;a<N;a++)
		{

			for (int b=0;b<N;b++)
			{
				printf("%f  ",C[a][b]);
				if (((b+1)%N)==0) printf("\n");
			} 
	
		}

		for (int a=0;a<N;a++)
		{

			for (int b=0;b<n;b++)
			{	
				row[b] = C[a][b];
			}
			IDWT(row, n);
			for (int b=0;b<n;b++)
			{
				R[a][b]= (int)row[b];
			} 
	
		}

		for (int a=0;a<N;a++)
		{

			for (int b=0;b<N;b++)
			{
				printf("%d  ",R[a][b]);
				if (((b+1)%N)==0) printf("\n");
			} 
	
		}

		delete(row);
	}


}
